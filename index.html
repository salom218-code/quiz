<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>×’×™×•×¡ ×¢×•×‘×“×™× ××¦×œ×š â€“ ×”×™××•×¨ ××• ××”×œ×š ××—×•×©×‘?</title>
  <meta name="description" content="×©××œ×•×Ÿ ×§×¦×¨ ×œ××¢×¡×™×§×™× â€“ ×‘×¡×•×£ ××§×‘×œ×™× ××‘×—×•×Ÿ ×¡×’× ×•×Ÿ × ×™×”×•×œ×™ ×•×ª×•×‘× ×•×ª ×œ×’×™×•×¡." />

  <!-- Performance-optimized font loading (replaces CSS @import) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#f5f7fb;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#475569;
      --line:#e2e8f0;
      --primary:#2563eb;
      --primary-2:#1d4ed8;
      --shadow:0 10px 30px rgba(2,6,23,.08);
      --r:18px;
    }
    *{box-sizing:border-box}

    body{
      margin:0;
      font-family: "Rubik", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background:
        radial-gradient(1200px 700px at 85% -10%, rgba(37,99,235,.18), transparent 60%),
        radial-gradient(900px 520px at 12% 0%, rgba(236,72,153,.14), transparent 55%),
        radial-gradient(900px 520px at 20% 110%, rgba(34,197,94,.12), transparent 55%),
        radial-gradient(700px 420px at 110% 70%, rgba(245,158,11,.10), transparent 55%),
        linear-gradient(180deg, rgba(255,255,255,.62), rgba(255,255,255,0)),
        var(--bg);
      color:var(--text);
      min-height:100dvh;
      overflow-x:hidden;
    }
    body::after{
      content:"";
      position:fixed;
      inset:0;
      pointer-events:none;
      background:
        linear-gradient(90deg, rgba(15,23,42,.03) 1px, transparent 1px),
        linear-gradient(0deg, rgba(15,23,42,.03) 1px, transparent 1px);
      background-size: 56px 56px;
      opacity:.22;
      z-index:-1;
    }

    a{color:inherit}

    .wrap{max-width:860px;margin:0 auto;padding:18px;}
    .top{
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      padding:10px 2px 14px;
    }
    .brand{display:flex;align-items:center;gap:10px;}
    .logo{
      width:40px;height:40px;border-radius:14px;
      background: linear-gradient(135deg, rgba(37,99,235,1), rgba(29,78,216,.85));
      box-shadow: 0 10px 25px rgba(37,99,235,.25);
      position:relative;
    }
    .logo:before{
      content:"";
      position:absolute;inset:10px;
      border-radius:12px;
      background:rgba(255,255,255,.18);
      transform:rotate(15deg);
    }
    .brand h1{font-size:16px;margin:0;line-height:1.2}

    .pill{
      display:inline-flex;align-items:center;gap:8px;
      padding:8px 12px;border:1px solid var(--line);
      border-radius:999px;background:rgba(255,255,255,.68);
      backdrop-filter: blur(6px);
      font-size:12.5px;color:var(--muted);
    }

    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--r);
      box-shadow:var(--shadow);
      overflow:hidden;
    }

    .hero{padding:18px 18px 8px;}
    .hero h2{margin:0 0 6px;font-size:20px;letter-spacing:-.2px;text-align:center}
    .hero .sub{margin:0;color:var(--muted);font-size:14px;line-height:1.55;text-align:center}

    .progress{
      padding:10px 18px 16px;
      display:flex;align-items:center;justify-content:space-between;gap:10px;
    }
    .bar{
      flex:1;height:10px;border-radius:999px;background:#eef2ff;
      border:1px solid rgba(37,99,235,.18);
      overflow:hidden;
    }
    .bar > i{display:block;height:100%;width:0%;background:linear-gradient(90deg,var(--primary),rgba(37,99,235,.7));border-radius:999px;transition:width .35s ease}
    .pct{font-size:12.5px;color:var(--muted);min-width:88px;text-align:left}

    .body{padding:0 18px 18px;}

    .screen{display:none;}
    .screen.active{display:block;}

    /* START */
    .startGrid{display:grid;gap:12px;grid-template-columns:1fr;align-items:start;}
    .startBox{
      border:1px solid rgba(226,232,240,.9);
      border-radius:18px;
      padding:16px;
      background:rgba(255,255,255,.72);
      backdrop-filter: blur(6px);
    }
    .startBox b{color:var(--text)}
    .startList{margin-top:12px;line-height:1.8;color:rgba(37,99,235,.85);font-size:15px}

    .form{
      border:1px solid var(--line);
      border-radius:16px;padding:14px;
      background:rgba(255,255,255,.78);
    }
    label{display:block;font-size:12.5px;color:var(--muted);margin:10px 0 6px}
    input, textarea{
      width:100%;padding:11px 12px;border-radius:12px;
      border:1px solid var(--line);
      background:#fff;outline:none;
      font-size:14px;
      font-family:inherit;
    }
    textarea{resize:vertical}
    input:focus, textarea:focus{border-color:rgba(37,99,235,.45);box-shadow:0 0 0 4px rgba(37,99,235,.12)}

    /* QUESTIONS */
    .qHead{margin:10px 0 10px;}
    .qMeta{display:flex;align-items:center;justify-content:space-between;gap:10px;color:var(--muted);font-size:12.5px;flex-wrap:wrap}
    .qTitle{margin:6px 0 0;font-size:18px;letter-spacing:-.2px}

    .options{display:grid;gap:10px;margin-top:12px;}
    .opt{
      border:1px solid var(--line);
      border-radius:16px;padding:12px 12px;
      display:flex;gap:10px;align-items:flex-start;
      background:#fff;
      cursor:pointer;
      transition:transform .08s ease, border-color .15s ease, box-shadow .15s ease, background .15s ease;
      user-select:none;
    }
    .opt:hover{transform:translateY(-1px);box-shadow:0 10px 20px rgba(2,6,23,.06)}
    .opt.selected{
      border-color: rgba(37,99,235,.55);
      background: rgba(37,99,235,.06);
      box-shadow: 0 12px 24px rgba(37,99,235,.10);
    }
    .opt input{width:18px;height:18px;margin-top:3px;accent-color:var(--primary)}

    .ico{
      width:38px;height:38px;border-radius:14px;
      background: linear-gradient(135deg, rgba(37,99,235,.30), rgba(37,99,235,.10));
      border:1px solid rgba(37,99,235,.30);
      display:grid;place-items:center;
      flex:0 0 auto;
      box-shadow: 0 10px 18px rgba(37,99,235,.18);
      color: var(--primary);
    }
    .ico svg{width:18px;height:18px}

    .optTxt{flex:1}
    .optTxt .t{font-size:14.5px;line-height:1.38}

    .actions{
      display:flex;gap:10px;justify-content:space-between;align-items:center;
      margin-top:16px;flex-wrap:wrap;
    }
    .btn{
      border:1px solid var(--line);
      background:#fff;
      border-radius:14px;
      padding:11px 14px;
      font-size:14px;
      cursor:pointer;
      display:inline-flex;align-items:center;gap:8px;
      transition:transform .08s ease, box-shadow .15s ease, border-color .15s ease, background .15s ease;
    }
    .btn:hover{transform:translateY(-1px);box-shadow:0 12px 24px rgba(2,6,23,.08)}
    .btn:disabled{opacity:.55;cursor:not-allowed;transform:none;box-shadow:none}
    .btn.primary{background:var(--primary);border-color:rgba(37,99,235,.6);color:#fff}
    .btn.primary:hover{background:var(--primary-2)}

    .toast{
      position:fixed;left:18px;bottom:18px;right:18px;
      display:none;justify-content:center;
      z-index:50;
    }
    .toast > div{
      max-width:860px;width:100%;
      background:#0b1220;color:#e2e8f0;
      border:1px solid rgba(148,163,184,.25);
      border-radius:14px;padding:12px 14px;
      box-shadow:0 20px 40px rgba(2,6,23,.3);
      font-size:13.5px;
      display:flex;align-items:center;justify-content:space-between;gap:12px;
    }
    .toast button{background:transparent;color:#e2e8f0;border:1px solid rgba(148,163,184,.25);border-radius:12px;padding:8px 10px;cursor:pointer}

    /* RESULT */
    .resultGrid{display:grid;gap:12px;grid-template-columns:1fr;align-items:start;margin-top:10px}
    .resultCard{border:1px solid var(--line);border-radius:16px;padding:14px;background:#fff}
    .resultCard h3{margin:0 0 10px;font-size:18px}

    .resultBlocks{display:grid;gap:12px;margin-top:8px}
    .rb{border:1px solid rgba(226,232,240,.9);border-radius:14px;padding:12px;background:rgba(248,250,252,.55)}

    /* Result block header: clearer hierarchy + subtle visual cue */
    .rbT{display:flex;align-items:center;gap:10px;font-size:15.5px;font-weight:700;color:var(--text);margin-bottom:6px}
    .rbI{width:26px;height:26px;border-radius:12px;display:grid;place-items:center;flex:0 0 auto;
      background:linear-gradient(135deg, rgba(37,99,235,.18), rgba(37,99,235,.06));
      border:1px solid rgba(37,99,235,.22);
      color:var(--primary);
      box-shadow:0 10px 18px rgba(37,99,235,.10);
    }
    .rbI svg{width:14px;height:14px}

    /* Body: slightly different tone from header for readability */
    .rbB{font-size:14px;color:rgba(71,85,105,.92);line-height:1.7}

    /* Subtle per-block tint (keeps it clean, still adds separation) */
    .rb--how{background:linear-gradient(180deg, rgba(37,99,235,.06), rgba(248,250,252,.55))}
    .rb--challenge{background:linear-gradient(180deg, rgba(245,158,11,.07), rgba(248,250,252,.55))}
    .rb--tip{background:linear-gradient(180deg, rgba(34,197,94,.07), rgba(248,250,252,.55))}

    .share{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px}
    .small{font-size:12.5px;color:var(--muted);line-height:1.6;margin-top:8px}

    @media (max-width: 520px){
      .wrap{padding:12px;}
      .top{flex-direction:column;align-items:stretch;gap:10px;}
      .pill{justify-content:center;width:100%;}
      .hero{padding:16px 14px 6px;}
      .progress{padding:10px 14px 14px;flex-direction:column;align-items:stretch;}
      .pct{min-width:auto;text-align:right;}
      .body{padding:0 14px 14px;}
      .actions{flex-direction:column;align-items:stretch;}
      .actions > .btn{width:100%;justify-content:center;}
      .actions > div{width:100%;}
      .actions > div > .btn{width:100%;justify-content:center;}
      .share .btn{width:100%;justify-content:center;}
      .rbT{font-size:16.5px}
    }
      .top{flex-direction:column;align-items:stretch;gap:10px;}
      .pill{justify-content:center;width:100%;}
      .hero{padding:16px 14px 6px;}
      .progress{padding:10px 14px 14px;flex-direction:column;align-items:stretch;}
      .pct{min-width:auto;text-align:right;}
      .body{padding:0 14px 14px;}
      .actions{flex-direction:column;align-items:stretch;}
      .actions > .btn{width:100%;justify-content:center;}
      .actions > div{width:100%;}
      .actions > div > .btn{width:100%;justify-content:center;}
      .share .btn{width:100%;justify-content:center;}

      /* Mobile-only: make the result headings a touch larger */
      .rbT{font-size:16.5px;}
      .rbB{font-size:14.5px;}
    }

    @media (prefers-reduced-motion: no-preference){
      .card{animation:pop .35s ease both}
      @keyframes pop{from{transform:translateY(6px);opacity:.0}to{transform:translateY(0);opacity:1}}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div class="brand" aria-label="×›×•×ª×¨×ª">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>××” ×”××•×¤×™ ×”× ×™×”×•×œ×™ ×©×œ×™</h1>
        </div>
      </div>
      <div class="pill" title="××©×š ××©×•×¢×¨">
        <span aria-hidden="true">â±ï¸</span>
        <span>×›Ö¾3â€“4 ×“×§×•×ª</span>
      </div>
    </div>

    <div class="card" role="application" aria-label="××‘×—×•×Ÿ">
      <div class="hero">
        <h2 id="screenTitle">×’×™×•×¡ ×¢×•×‘×“×™× ××¦×œ×š â€“ ×”×™××•×¨ ××• ××”×œ×š ××—×•×©×‘?</h2>
        <p class="sub" id="screenSubtitle">××¢× ×” ×§×¦×¨ ×©×™×¢×–×•×¨ ×œ×š ×œ×”×‘×™×Ÿ ××ª ×”××•×¤×™ ×”× ×™×”×•×œ×™ ×©×œ×š ×•××™×š ×”×•× ××©×¤×™×¢ ×¢×œ ×’×™×•×¡ ×¢×•×‘×“×™×.</p>
      </div>

      <div class="progress" aria-label="×”×ª×§×“××•×ª">
        <div class="bar" aria-hidden="true"><i id="barFill"></i></div>
        <div class="pct" id="pctText">0% ×”×•×©×œ×</div>
      </div>

      <div class="body">
        <!-- START -->
        <section class="screen active" id="screen-start">
          <div class="startGrid">
            <div class="startBox" style="text-align:center">
              <b>××” ×ª×§×‘×œ ×‘×¡×•×£?</b>
              <div class="startList">
                ×›××” ×©××œ×•×ª ×§×¦×¨×•×ª ×©×™×ª× ×• ×œ×š ×ª××•× ×” ×‘×¨×•×¨×” ×¢×œ ×”××•×¤×Ÿ ×©×‘×• ××ª×” ×× ×”×œ â€” ×•××™×¤×” ×–×” ×¤×•×’×© ××ª ×”×’×™×•×¡ ×•×”×¢×‘×•×“×” ×¢× ×× ×©×™×.
              </div>

              <div class="actions" style="margin-top:14px;justify-content:center">
                <button class="btn primary" id="btnStart">
                  <span aria-hidden="true">â–¶</span>
                  <span>×”×ª×—×œ</span>
                </button>
              </div>
            </div>
          </div>
        </section>

        <!-- QUIZ -->
        <section class="screen" id="screen-quiz" aria-label="×©××œ×•×ª">
          <div class="qHead">
            <div class="qMeta">
              <div id="qCounter">×©××œ×” 1 ××ª×•×š 12</div>
              <div id="qHint"></div>
            </div>
            <h3 class="qTitle" id="qText">â€¦</h3>
          </div>

          <div class="options" id="options"></div>

          <div class="actions">
            <button class="btn" id="btnBack">
              <span aria-hidden="true">â†</span>
              <span>×—×–×¨×”</span>
            </button>
            <button class="btn primary" id="btnNext" disabled>
              <span>×”××©×š</span>
              <span aria-hidden="true">â†’</span>
            </button>
          </div>
        </section>

        <!-- DETAILS (optional) -->
        <section class="screen" id="screen-details" aria-label="×¤×¨×˜×™×">
          <div class="startGrid" style="grid-template-columns:1fr;">
            <div class="startBox">
              <b>××¢×•× ×™×™×Ÿ ×œ×©××•×¢ ×¤×¨×˜×™× ×¢×œ ×”×©×™×¨×•×ª?</b><br>
              <span class="small" style="margin-top:6px;display:block">×–×” ××•×¤×¦×™×•× ×œ×™ ×œ×’××¨×™. ×× ×–×” ×¨×œ×•×•× ×˜×™ ×¢×‘×•×¨×š â€” ××œ×/×™ ×¤×¨×˜×™× ×•× ×—×–×•×¨ ××œ×™×š. ××¤×©×¨ ×’× ×œ×“×œ×’ ×™×©×¨ ×œ×ª×•×¦××”.</span>
            </div>

            <div class="form">
              <label for="fullName">×©× ××œ× (××•×¤×¦×™×•× ×œ×™)</label>
              <input id="fullName" autocomplete="name" placeholder="" />

              <label for="email">××™××™×™×œ (××•×¤×¦×™×•× ×œ×™)</label>
              <input id="email" type="email" autocomplete="email" placeholder="name@example.com" />

              <label for="phone">×˜×œ×¤×•×Ÿ (××•×¤×¦×™×•× ×œ×™)</label>
              <input id="phone" type="tel" autocomplete="tel" placeholder="" />

              <label for="company2">×©× ×—×‘×¨×” / ××¨×’×•×Ÿ (××•×¤×¦×™×•× ×œ×™)</label>
              <input id="company2" autocomplete="organization" placeholder="" />

              <div class="actions" style="margin-top:14px">
                <button class="btn" id="btnDetailsBack">
                  <span aria-hidden="true">â†</span>
                  <span>×—×–×¨×”</span>
                </button>
                <div style="display:flex;gap:10px;flex-wrap:wrap">
                  <button class="btn" id="btnSkipDetails">
                    <span>×“×œ×’ ×œ×ª×•×¦××”</span>
                    <span aria-hidden="true">â†’</span>
                  </button>
                  <button class="btn primary" id="btnShowResult" disabled>
                    <span>×©×œ×— ×¤×¨×˜×™× ×•×”×¦×’ ×ª×•×¦××”</span>
                    <span aria-hidden="true">â†’</span>
                  </button>
                </div>
              </div>

              <div class="small">×× ××™×œ××ª ×¤×¨×˜×™× â€” × ×‘×§×© ×œ×¤×—×•×ª ×©× + ××™××™×™×œ ×ª×§×™×Ÿ ×›×“×™ ×©× ×•×›×œ ×œ×—×–×•×¨ ××œ×™×š.</div>
            </div>
          </div>
        </section>

        <!-- RESULT -->
        <section class="screen" id="screen-result" aria-label="×ª×•×¦××”">
          <div class="resultGrid">
            <div class="resultCard">
              <h3 id="resultTitle">×”×ª×•×¦××” ×©×œ×š: â€¦</h3>
              <div id="resultBody" class="resultBlocks"></div>

              <div class="share" aria-label="×©×™×ª×•×£">
                <button class="btn primary" id="btnShareWa"><span aria-hidden="true">ğŸ“²</span><span>×©×ª×£ ×‘×•×•××˜×¡××¤</span></button>
                <button class="btn" id="btnCopy"><span aria-hidden="true">ğŸ“‹</span><span>×”×¢×ª×§ ×”×•×“×¢×”</span></button>
                <button class="btn" id="btnCopyLink"><span aria-hidden="true">ğŸ”—</span><span>×”×¢×ª×§ ×§×™×©×•×¨</span></button>
                <button class="btn" id="btnRestart"><span aria-hidden="true">â†»</span><span>×”×ª×—×œ ××—×“×©</span></button>
              </div>
            </div>
          </div>
        </section>
      </div>
    </div>
  </div>

  <div class="toast" id="toast" role="status" aria-live="polite">
    <div><span id="toastText">×”×•×¢×ª×§</span><button id="toastClose">×¡×’×•×¨</button></div>
  </div>

<script>
  // ---------------------------------
  // Helpers
  // ---------------------------------
  const $ = (id) => document.getElementById(id);
  const safeText = (id, txt) => { const el = $(id); if (el) el.textContent = txt; };

  function escapeHtml(str){
    return String(str ?? '').replace(/[&<>"']/g, (c) => ({
      "&":"&amp;",
      "<":"&lt;",
      ">":"&gt;",
      "\"":"&quot;",
      "'":"&#39;"
    }[c]));
  }

  // ---------------------------------
  // Icons
  // ---------------------------------
  const ICONS = {
    list:   '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 6h13M8 12h13M8 18h13"/><path d="M3 6h.01M3 12h.01M3 18h.01"/></svg>',
    hand:   '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M7 11v-2a2 2 0 1 1 4 0v2"/><path d="M11 11V7a2 2 0 1 1 4 0v4"/><path d="M15 11V9a2 2 0 1 1 4 0v6a6 6 0 0 1-6 6H9a6 6 0 0 1-6-6v-3a2 2 0 1 1 4 0v1"/></svg>',
    bolt:   '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>',
    spark:  '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2l1.8 5.5L19 9.3l-5.2 1.8L12 16l-1.8-4.9L5 9.3l5.2-1.8L12 2z"/></svg>',
    shield: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2l8 4v6c0 5-3.5 9.5-8 10-4.5-.5-8-5-8-10V6l8-4z"/></svg>',
    leaf:   '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 4c-7 1-12 6-13 13"/><path d="M7 17c-2 0-4-2-4-4 0-6 6-9 17-9 0 11-3 17-9 17-2 0-4-2-4-4"/></svg>',
    target: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="9"/><circle cx="12" cy="12" r="4"/></svg>',
    grid:   '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3h7v7H3zM14 3h7v7h-7zM3 14h7v7H3zM14 14h7v7h-7z"/></svg>',
    users:  '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H7a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/></svg>',
    fast:   '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12h6"/><path d="M3 6h10"/><path d="M3 18h10"/><path d="M14 9l4 3-4 3"/></svg>',
    compass:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M16 8l-2 8-8 2 2-8 8-2z"/></svg>',
    pin:    '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 21s7-4.5 7-11a7 7 0 0 0-14 0c0 6.5 7 11 7 11z"/></svg>',
    key:    '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 2l-2 2"/><path d="M7 12a5 5 0 1 1 9.9 1H22v4h-4v-2h-2v2h-4.1A5 5 0 0 1 7 12z"/></svg>',
    clock:  '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>',
    bulb:   '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18h6"/><path d="M12 2a7 7 0 0 0-4 12c.6.6 1 1.3 1 2v1h6v-1c0-.7.4-1.4 1-2A7 7 0 0 0 12 2z"/></svg>',
    checklist:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 6h13M9 12h13M9 18h13"/><path d="M3 6l1 1 2-2"/><path d="M3 12l1 1 2-2"/><path d="M3 18l1 1 2-2"/></svg>',
    trophy: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 21h8"/><path d="M7 4h10v4a5 5 0 0 1-10 0V4z"/></svg>',
    heart:  '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.8 4.6a5.5 5.5 0 0 0-7.8 0L12 5.6l-1-1a5.5 5.5 0 0 0-7.8 7.8l1 1L12 22l7.8-8.6 1-1a5.5 5.5 0 0 0 0-7.8z"/></svg>',
    search: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="7"/><path d="M21 21l-4.3-4.3"/></svg>',
    route:  '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="6" cy="6" r="2"/><circle cx="18" cy="18" r="2"/><path d="M8 6h6a4 4 0 0 1 4 4v6"/></svg>',
    zap:    '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 14l6-6v4h10l-6 6v-4H4z"/></svg>',
    flag:   '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 22V2"/><path d="M4 4h14l-2 5 2 5H4"/></svg>',
    ruler:  '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 21l18-18"/></svg>',
    meter:  '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 13a8 8 0 1 1-16 0"/><path d="M12 13l6-3"/></svg>',
    layers: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2l9 5-9 5-9-5 9-5z"/></svg>',
    star:   '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2l3 7 7 .6-5.3 4.6 1.7 7.2L12 18l-6.4 3.4 1.7-7.2L2 9.6 9 9l3-7z"/></svg>',
    doc:    '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/></svg>',
    chat:   '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a4 4 0 0 1-4 4H8l-5 3V7a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4z"/></svg>',
    arrow:  '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14"/><path d="M13 6l6 6-6 6"/></svg>'
  };

  // ---------------------------------
  // Content
  // ---------------------------------
  const TYPES = [
    { key:'central',   name:'×”×× ×”×œ ×”×¨×™×›×•×–×™',  how:'××ª×” ××•×”×‘ ×©×œ×™×˜×”, ×¡×“×¨ ×•×‘×”×™×¨×•×ª. ×—×©×•×‘ ×œ×š ×œ×“×¢×ª ××” ×§×•×¨×”, ××™ ×¢×•×©×” ××”, ×•××™×š. ×“×‘×¨×™× ×¢×•×‘×“×™× ×˜×•×‘ ×›×©××ª×” ××¢×•×¨×‘.', challenge:'×¢×•××¡ ×™×ª×¨ ×•×©×—×™×§×” â€” ×›×©×™×•×ª×¨ ××“×™ ×“×‘×¨×™× ×¢×•×‘×¨×™× ×“×¨×›×š.', tip:'×¢×•×‘×“×™× ×©××¦×œ×™×—×™× ××¦×œ×š ×”× ×›××œ×” ×©××¢×¨×™×›×™× ××¡×’×¨×ª, ×“×™×•×§ ×•×¦×™×¤×™×•×ª ×‘×¨×•×¨×•×ª. ×’×™×•×¡ ×œ× ××“×•×™×§ ×™×¤×™×œ ×¢×œ×™×š ×¢×•×“ ×¢×‘×•×“×”.' },
    { key:'delegator', name:'×”×× ×”×œ ×”×××¦×™×œ',  how:'××ª×” × ×•×ª×Ÿ ×××•×Ÿ, ×—×•×¤×© ×•××—×¨×™×•×ª. ××¦×¤×” ×©×× ×©×™× ×™×”×™×• ×‘×•×’×¨×™×, ×™×•×–××™× ×•×¢×¦×××™×™×.', challenge:'×—×•×¡×¨ ××—×™×“×•×ª ×•×‘×œ×’×Ÿ ×ª×¤×¢×•×œ×™ ×›×©××™×Ÿ ××¡×¤×™×§ ××¡×’×¨×•×ª ×¤×©×•×˜×•×ª.', tip:'×›×“××™ ×œ×¡× ×Ÿ ×× ×©×™× ×©×œ× ×™×•×“×¢×™× ×œ× ×”×œ ××ª ×¢×¦××, ××—×¨×ª ×”×—×•×¤×© ×©××ª×” × ×•×ª×Ÿ ×”×•×¤×š ×œ×—×•×œ×©×”.' },
    { key:'executor',  name:'×”×× ×”×œ ×”×‘×™×¦×•×¢×™×¡×˜', how:'×§×¦×‘, ×ª×•×¦××•×ª, ×”×ª×§×“××•×ª. ××ª×” ×œ× ××•×”×‘ ××¨×™×—×•×ª â€” ×¨×•×¦×” ×œ×¨××•×ª ×ª× ×•×¢×” ×•××”×¨.', challenge:'×©×—×™×§×” ×•×ª×—×œ×•×¤×” ×©×œ ×× ×©×™× ×©×œ× ×¢×•××“×™× ×‘×§×¦×‘.', tip:'×—×©×•×‘ ×œ×’×™×™×¡ ×× ×©×™× ×¢× ×—×•×¡×Ÿ, ××—×•×™×‘×•×ª ×•×™×›×•×œ×ª ×œ×¢××•×“ ×‘×œ×—×¥ â€” ×œ× ×¨×§ â€œ×›×™×©×¨×•×Ÿâ€.' },
    { key:'visionary', name:'×”×× ×”×œ ×”×—×–×•× ×™',  how:'××ª×” ×—×•×©×‘ ×¨×—×•×§, ××“×‘×¨ ×¢×¨×›×™×, ×¨×•××” ×ª××•× ×” ×’×“×•×œ×” ×•×× ×™×¢ ×× ×©×™× ×“×¨×š ×¨×¢×™×•×Ÿ.', challenge:'× ×¤×™×œ×” ×‘×¤×¨×˜×™× ×•×‘×¡×’×™×¨×ª ×§×¦×•×•×ª ×›×©××™×Ÿ ××™ ×©××—×–×™×§ ×‘×™×¦×•×¢.', tip:'×›×“××™ ×œ×’×™×™×¡ ×¢×•×‘×“×™× ××©×œ×™××™× â€” ×¤×¨×§×˜×™×™×, ××¡×•×“×¨×™×, ×›××œ×” ×©×¡×•×’×¨×™× ××ª ×”×¤×¢×¨ ×‘×™×Ÿ ×—×–×•×Ÿ ×œ××¦×™××•×ª.' }
  ];

  const QUESTIONS = [
    { id:1, type:'mc', section:'××‘×—×•×Ÿ ×¡×’× ×•×Ÿ × ×™×”×•×œ×™', text:'×›×©×¢×•×‘×“ ×—×“×© ××ª×—×™×œ ×œ×¢×‘×•×“ ××¦×œ×š, ××” ×”×›×™ ×—×©×•×‘ ×œ×š ×‘×©×‘×•×¢ ×”×¨××©×•×Ÿ?', options:[
      {t:'×©×™×‘×™×Ÿ ×‘×“×™×•×§ ××” ××¦×•×¤×” ××× ×•, ×©×œ×‘Ö¾×©×œ×‘', score:{central:1}, icon:'list'},
      {t:'×œ×”×¨×’×™×© ×©×”×•× ×¢×¦×××™ ×•×™×•×“×¢ ×œ×”×¡×ª×“×¨', score:{delegator:1}, icon:'hand'},
      {t:'×œ×¨××•×ª ×ª×•×¦××•×ª ×›××” ×©×™×•×ª×¨ ××”×¨', score:{executor:1}, icon:'bolt'},
      {t:'×©×™×ª×—×‘×¨ ×œ×—×–×•×Ÿ ×•×œ×›×™×•×•×Ÿ ×”×›×œ×œ×™', score:{visionary:1}, icon:'spark'}
    ]},
    { id:2, type:'mc', section:'××‘×—×•×Ÿ ×¡×’× ×•×Ÿ × ×™×”×•×œ×™', text:'×›×©×™×© ×˜×¢×•×ª ×‘×¢×‘×•×“×”:', options:[
      {t:'×× ×™ ××¢×“×™×£ ×œ×”×™×•×ª ××¢×•×¨×‘ ×•×œ×ª×§×Ÿ ×‘×¢×¦××™', score:{central:1}, icon:'shield'},
      {t:'× ×•×ª×Ÿ ×œ×¢×•×‘×“ ×œ×œ××•×“ ××”×˜×¢×•×ª', score:{delegator:1}, icon:'leaf'},
      {t:'×”×¢×™×§×¨ ×©×œ× ×™×¤×’×¢ ×‘×ª×•×¦××” ×”×¡×•×¤×™×ª', score:{executor:1}, icon:'target'},
      {t:'×‘×•×—×Ÿ ×× ×”×‘×¢×™×” ×”×™× ×‘××‘× ×” ×•×œ× ×‘××“×', score:{visionary:1}, icon:'grid'}
    ]},
    { id:3, type:'mc', section:'××‘×—×•×Ÿ ×¡×’× ×•×Ÿ × ×™×”×•×œ×™', text:'××™×š × ×¨××•×ª ×”×—×œ×˜×•×ª ××¦×œ×š?', options:[
      {t:'×× ×™ ××—×œ×™×˜ ×‘×¡×•×£', score:{central:1}, icon:'ruler'},
      {t:'××ª×™×™×¢×¥ ×•× ×•×ª×Ÿ ××§×•×', score:{delegator:1}, icon:'users'},
      {t:'××—×œ×™×˜ ××”×¨ ×•××ª×§×“×', score:{executor:1}, icon:'fast'},
      {t:'×—×•×©×‘ ×§×“×™××”, ×’× ×× ×–×” ×œ×•×§×— ×–××Ÿ', score:{visionary:1}, icon:'compass'}
    ]},
    { id:4, type:'mc', section:'××‘×—×•×Ÿ ×¡×’× ×•×Ÿ × ×™×”×•×œ×™', text:'××” ×”×›×™ ××ª×¡×›×œ ××•×ª×š ×‘×¢×•×‘×“×™×?', options:[
      {t:'×—×•×¡×¨ ×“×™×•×§', score:{central:1}, icon:'pin'},
      {t:'×—×•×¡×¨ ××—×¨×™×•×ª', score:{delegator:1}, icon:'key'},
      {t:'××™×˜×™×•×ª', score:{executor:1}, icon:'clock'},
      {t:'×—×•×¡×¨ ×™×•×–××”', score:{visionary:1}, icon:'bulb'}
    ]},
    { id:5, type:'mc', section:'××‘×—×•×Ÿ ×¡×’× ×•×Ÿ × ×™×”×•×œ×™', text:'××” ×œ×“×¢×ª×š ×¢×•×©×” ×¢×•×‘×“ ×˜×•×‘ ×œ××•×¨×š ×–××Ÿ?', options:[
      {t:'××©××¢×ª ×•×”×ª××“×”', score:{central:1}, icon:'checklist'},
      {t:'×¢×¦×××•×ª ×•××—×¨×™×•×ª', score:{delegator:1}, icon:'hand'},
      {t:'×¨×¢×‘ ×œ×”×™×©×’×™×', score:{executor:1}, icon:'trophy'},
      {t:'×—×™×‘×•×¨ ×œ×¢×¨×›×™× ×•×œ××©××¢×•×ª', score:{visionary:1}, icon:'heart'}
    ]},
    { id:6, type:'mc', section:'××‘×—×•×Ÿ ×¡×’× ×•×Ÿ × ×™×”×•×œ×™', text:'×‘×™×•× ×¢××•×¡ ×‘××™×•×—×“ ××ª×”:', options:[
      {t:'× ×›× ×¡ ×œ×¤×¨×˜×™×', score:{central:1}, icon:'search'},
      {t:'××—×œ×§ ×¡××›×•×™×•×ª', score:{delegator:1}, icon:'route'},
      {t:'×“×•×—×£ ×œ×¡×’×•×¨ ××©×™××•×ª', score:{executor:1}, icon:'zap'},
      {t:'×¢×•×¦×¨ ×œ×—×©×•×‘ ××” ×‘×××ª ×—×©×•×‘', score:{visionary:1}, icon:'flag'}
    ]},

    { id:7, type:'mc', section:'××¦×‘ ×”×’×™×•×¡', text:'××” ××¦×‘ ×”×’×™×•×¡ ××¦×œ×š ×›×¨×’×¢?', options:[
      {t:'×¦×¨×™×š ×¢×•×‘×“ ×œ××ª××•×œ', icon:'bolt'},
      {t:'××’×™×™×¡ ×‘× ×—×ª', icon:'leaf'},
      {t:'××—×¤×© ×“××•×ª ××¤×ª×—', icon:'star'},
      {t:'×œ× ××’×™×™×¡ ×›×¨×’×¢', icon:'doc'}
    ]},
    { id:8, type:'scale', section:'××¦×‘ ×”×’×™×•×¡', text:'×¢×“ ×›××” ××ª×” ×¡×•××š ×¢×œ ×ª×”×œ×™×š ×”×’×™×•×¡ ×©×œ×š ×”×™×•×?', scale:{min:1,max:5,left:'1 â€“ ×‘×›×œ×œ ×œ×',right:'5 â€“ ×××•×“'} },
    { id:9, type:'mc', section:'××¦×‘ ×”×’×™×•×¡', text:'××” ×”×—×œ×§ ×©×”×›×™ ×©×•×¨×£ ×œ×š ×–××Ÿ ×‘×’×™×•×¡?', options:[
      {t:'×”×’×“×¨×ª ×”×ª×¤×§×™×“', icon:'ruler'},
      {t:'×¤×¨×¡×•×', icon:'arrow'},
      {t:'×¡×™× ×•×Ÿ ×§×•×´×—', icon:'search'},
      {t:'×¨××™×•× ×•×ª ×©×œ× × ×¡×’×¨×™×', icon:'chat'}
    ]},
    { id:10, type:'mc', section:'××¦×‘ ×”×’×™×•×¡', text:'××” ×”××—×™×¨ ×©×œ ×’×™×•×¡ ×›×•×©×œ ×©×—×•×•×™×ª?', options:[
      {t:'×›×¡×£', icon:'meter'},
      {t:'×–××Ÿ × ×™×”×•×œ×™', icon:'clock'},
      {t:'×¤×’×™×¢×” ×‘×¦×•×•×ª', icon:'users'},
      {t:'×”×›×•×œ ×‘×™×—×“', icon:'layers'}
    ]},
    { id:11, type:'scale', section:'××¦×‘ ×”×’×™×•×¡', text:'×¢×“ ×›××” ×©×™×¨×•×ª ×—×™×¦×•× ×™ ×©××‘×™× ×¨×§ 3 ××•×¢××“×™× ××“×•×™×§×™× ×¨×œ×•×•× ×˜×™ ×¢×‘×•×¨×š?', scale:{min:1,max:5,left:'1 â€“ ×œ× ×¨×œ×•×•× ×˜×™',right:'5 â€“ ×¨×œ×•×•× ×˜×™ ×××•×“'} },
    { id:12, type:'text', section:'××¦×‘ ×”×’×™×•×¡', text:'×”×§×•×©×™ ×”×›×™ ×’×“×•×œ ×©×œ×š ×”×™×•× ×‘×’×™×•×¡ ××• ×‘× ×™×”×•×œ ×¢×•×‘×“×™×:', placeholder:'××•×¤×¦×™×•× ×œ×™ â€” ×× ×‘× ×œ×š, ×›×ª×•×‘/×™ ×›××Ÿ ×‘×§×¦×¨×”â€¦' }
  ];

  // ---------------------------------
  // State
  // ---------------------------------
  const state = {
    step:'start',
    i:0,
    answers: Array(QUESTIONS.length).fill(null),
    scores: {central:0, delegator:0, executor:0, visionary:0},
    firstHit: {central:null, delegator:null, executor:null, visionary:null},
    lead: {fullName:'', email:'', phone:''},
    org: {company:''}
  };

  const screens = { start: $('screen-start'), quiz: $('screen-quiz'), details: $('screen-details'), result: $('screen-result') };

  // ---------------------------------
  // UI
  // ---------------------------------
  function showToast(msg){
    safeText('toastText', msg);
    const t = $('toast');
    if (!t) return;
    t.style.display = 'flex';
    clearTimeout(showToast._t);
    showToast._t = setTimeout(() => { t.style.display = 'none'; }, 2400);
  }
  $('toastClose')?.addEventListener('click', () => { const t = $('toast'); if (t) t.style.display = 'none'; });

  function setScreen(which){
    Object.values(screens).forEach(s => s && s.classList.remove('active'));
    screens[which]?.classList.add('active');
    state.step = which;

    const titles = {
      start: ['×’×™×•×¡ ×¢×•×‘×“×™× ××¦×œ×š â€“ ×”×™××•×¨ ××• ××”×œ×š ××—×•×©×‘?', '××¢× ×” ×§×¦×¨ ×©×™×¢×–×•×¨ ×œ×š ×œ×”×‘×™×Ÿ ××ª ×”××•×¤×™ ×”× ×™×”×•×œ×™ ×©×œ×š ×•××™×š ×”×•× ××©×¤×™×¢ ×¢×œ ×’×™×•×¡ ×¢×•×‘×“×™×.'],
      quiz: ['', ''],
      details: ['×¨×•×¦×” ×œ×©××•×¢ ×¤×¨×˜×™× ×¢×œ ×”×©×™×¨×•×ª?', ''],
      result: ['×”×ª×•×¦××” ×©×œ×š', '']
    };
    safeText('screenTitle', titles[which][0]);
    safeText('screenSubtitle', titles[which][1]);
  }

  function progress(){
    let answered = 0;
    for (let idx=0; idx<state.answers.length; idx++){
      const a = state.answers[idx];
      if (a === null) continue;
      answered += 1;
    }
    const pct = Math.round((answered / QUESTIONS.length) * 100);
    const bar = $('barFill');
    if (bar) bar.style.width = pct + '%';
    safeText('pctText', pct + '% ×”×•×©×œ×');
  }

  function resetScores(){
    state.scores = {central:0, delegator:0, executor:0, visionary:0};
    state.firstHit = {central:null, delegator:null, executor:null, visionary:null};

    for (let i=0;i<QUESTIONS.length;i++){
      const q = QUESTIONS[i];
      const a = state.answers[i];
      if (a === null) continue;
      if (q.id > 6) continue;
      const opt = q.options?.[a];
      if (!opt || !opt.score) continue;
      for (const k in opt.score){
        const add = opt.score[k];
        state.scores[k] += add;
        if (add > 0 && state.firstHit[k] === null) state.firstHit[k] = i;
      }
    }
  }

  function topType(){
    const entries = Object.keys(state.scores).map(k => ({k, v: state.scores[k], first: (state.firstHit[k] ?? 999)}));
    entries.sort((a,b) => (b.v - a.v) || (a.first - b.first));
    return entries[0].k;
  }

  function clearSelected(){
    document.querySelectorAll('.opt.selected').forEach(x => x.classList.remove('selected'));
  }

  function goNext(){
    const a = state.answers[state.i];
    if (a === null) return;

    if (state.i < QUESTIONS.length - 1){
      state.i += 1;
      renderQuestion();
    } else {
      setScreen('details');
      validateDetails();
    }
  }

  function renderQuestion(){
    const q = QUESTIONS[state.i];
    const secLabel = q.section ? ' â€¢ ' + q.section : '';
    safeText('qCounter', '×©××œ×” ' + (state.i+1) + ' ××ª×•×š ' + QUESTIONS.length + secLabel);
    safeText('qText', q.text);

    const container = $('options');
    if (!container) return;
    container.innerHTML = '';

    const nextBtn = $('btnNext');

    if (q.type === 'mc'){
      q.options.forEach((o, idx) => {
        const id = 'opt-' + state.i + '-' + idx;
        const chosen = state.answers[state.i] === idx;
        const icon = ICONS[o.icon] || ICONS.spark;

        const el = document.createElement('label');
        el.className = 'opt' + (chosen ? ' selected' : '');
        el.setAttribute('for', id);
        el.innerHTML =
          '<div class="ico" aria-hidden="true">' + icon + '</div>' +
          '<input type="radio" name="q" id="' + id + '" ' + (chosen ? 'checked' : '') + ' />' +
          '<div class="optTxt"><div class="t">' + escapeHtml(o.t) + '</div></div>';

        el.addEventListener('click', () => {
          state.answers[state.i] = idx;
          clearSelected();
          el.classList.add('selected');
          if (nextBtn) nextBtn.disabled = false;
          progress();
          setTimeout(() => goNext(), 120);
        });

        container.appendChild(el);
      });
    }

    if (q.type === 'scale'){
      const hint = document.createElement('div');
      hint.className = 'small';
      hint.style.marginTop = '0';
      hint.textContent = (q.id === 11)
        ? '1 â€“ ×œ× ×¨×œ×•×•× ×˜×™   â€¢   5 â€“ ×¨×œ×•×•× ×˜×™ ×××•×“'
        : '1 â€“ ×‘×›×œ×œ ×œ×   â€¢   5 â€“ ×××•×“';
      container.appendChild(hint);

      const chosen = state.answers[state.i];
      for (let n=q.scale.min; n<=q.scale.max; n++){
        const id = 'opt-' + state.i + '-' + n;
        const el = document.createElement('label');
        el.className = 'opt' + (chosen === n ? ' selected' : '');
        el.setAttribute('for', id);
        el.innerHTML =
          '<div class="ico" aria-hidden="true">' + ICONS.meter + '</div>' +
          '<input type="radio" name="q" id="' + id + '" ' + (chosen === n ? 'checked' : '') + ' />' +
          '<div class="optTxt"><div class="t">' + n + '</div></div>';

        el.addEventListener('click', () => {
          state.answers[state.i] = n;
          clearSelected();
          el.classList.add('selected');
          if (nextBtn) nextBtn.disabled = false;
          progress();
          setTimeout(() => goNext(), 120);
        });

        container.appendChild(el);
      }
    }

    if (q.type === 'text'){
      const box = document.createElement('div');
      box.className = 'form';
      box.style.padding = '12px';
      box.innerHTML = '<textarea id="txtAnswer" rows="5" placeholder="' + escapeHtml(q.placeholder || '') + '"></textarea>';
      container.appendChild(box);

      const ta = box.querySelector('#txtAnswer');
      ta.value = (state.answers[state.i] ?? '');
      const validate = () => {
        state.answers[state.i] = ta.value || '';
        if (nextBtn) nextBtn.disabled = false;
        progress();
      };
      ta.addEventListener('input', validate);
      setTimeout(validate, 0);
    }

    const back = $('btnBack');
    if (back) back.disabled = (state.i === 0);

    const a = state.answers[state.i];
    if (nextBtn){
      nextBtn.disabled = (a === null);
      if (q.type === 'text') nextBtn.disabled = false;
    }
  }

  function resultHtml(key){
    const t = TYPES.find(x => x.key === key);
    return (
      '<div class="rb rb--how">'
        + '<div class="rbT"><span class="rbI" aria-hidden="true">' + (ICONS.spark || '') + '</span><strong>××™×š ×–×” × ×¨××” ×‘×¤×•×¢×œ</strong></div>'
        + '<div class="rbB">' + escapeHtml(t.how) + '</div>'
      + '</div>'

      + '<div class="rb rb--challenge">'
        + '<div class="rbT"><span class="rbI" aria-hidden="true">' + (ICONS.target || '') + '</span><strong>××ª×’×¨ × ×¤×•×¥</strong></div>'
        + '<div class="rbB">' + escapeHtml(t.challenge) + '</div>'
      + '</div>'

      + '<div class="rb rb--tip">'
        + '<div class="rbT"><span class="rbI" aria-hidden="true">' + (ICONS.bulb || '') + '</span><strong>×˜×™×¤ ×’×™×•×¡×™</strong></div>'
        + '<div class="rbB">' + escapeHtml(t.tip) + '</div>'
      + '</div>'
    );
  }

  function renderResult(){
    resetScores();
    const top = topType();
    const t = TYPES.find(x => x.key === top);

    safeText('resultTitle', '×”×ª×•×¦××” ×©×œ×š: ' + t.name);
    const rb = $('resultBody');
    if (rb) rb.innerHTML = resultHtml(top);

    progress();
  }

  function shareMessage(){
    resetScores();
    const top = topType();
    const t = TYPES.find(x => x.key === top);

    const fullName = (state.lead.fullName || '').trim();
    const company = (state.org.company || '').trim();
    const header = '×ª×•×¦××” â€“ ' + t.name + (fullName ? (' | ' + fullName) : '') + (company ? (' (' + company + ')') : '');

    const NL = '\n';
    const NL2 = '\n\n';

    let link = '';
    if (location && location.href && !location.href.startsWith('file:')) link = location.href;
    const linkLine = link ? (NL2 + '×œ××™×œ×•×™: ' + link) : '';

    const body = [
      '××™×š ×–×” × ×¨××” ×‘×¤×•×¢×œ: ' + t.how,
      '××ª×’×¨ × ×¤×•×¥: ' + t.challenge,
      '×˜×™×¤ ×’×™×•×¡×™: ' + t.tip
    ].join(NL2);

    return header + NL2 + body + linkLine;
  }

  async function copyText(txt){
    try{
      await navigator.clipboard.writeText(txt);
      showToast('×”×•×¢×ª×§');
    }catch{
      const ta = document.createElement('textarea');
      ta.value = txt;
      document.body.appendChild(ta);
      ta.select();
      document.execCommand('copy');
      ta.remove();
      showToast('×”×•×¢×ª×§');
    }
  }

  function validateDetails(){
    const fullName = (($('fullName')?.value) || '').trim();
    const email = (($('email')?.value) || '').trim();
    const phone = (($('phone')?.value) || '').trim();
    const company2 = (($('company2')?.value) || '').trim();

    const any = Boolean(fullName || email || phone || company2);
    const at = email.indexOf('@');
    const dot = email.lastIndexOf('.');
    const emailOk = (at > 0 && dot > at + 1 && dot < email.length - 1);
    const ok = (!any) || (fullName.length >= 2 && emailOk);

    const btn = $('btnShowResult');
    if (btn) btn.disabled = !ok;
  }

  // ---------------------------------
  // Self-tests (basic) â€” won't affect UI
  // ---------------------------------
  function runSelfTests(){
    const assert = (cond, msg) => { if (!cond) throw new Error('Test failed: ' + msg); };

    // Test: resultHtml should include all headers
    const html = resultHtml('central');
    assert(html.includes('××™×š ×–×” × ×¨××” ×‘×¤×•×¢×œ'), 'resultHtml missing "××™×š ×–×” × ×¨××” ×‘×¤×•×¢×œ"');
    assert(html.includes('××ª×’×¨ × ×¤×•×¥'), 'resultHtml missing "××ª×’×¨ × ×¤×•×¥"');
    assert(html.includes('×˜×™×¤ ×’×™×•×¡×™'), 'resultHtml missing "×˜×™×¤ ×’×™×•×¡×™"');

    // Test: tie-break uses earliest firstHit
    state.answers = Array(QUESTIONS.length).fill(null);
    state.answers[0] = 0; // central +1
    state.answers[1] = 1; // delegator +1
    resetScores();
    // force tie by direct manipulation
    state.scores.central = 1; state.scores.delegator = 1;
    state.firstHit.central = 0; state.firstHit.delegator = 3;
    assert(topType() === 'central', 'tie-break should prefer earlier firstHit');
  }

  // ---------------------------------
  // Events
  // ---------------------------------
  $('btnStart')?.addEventListener('click', () => {
    setScreen('quiz');
    state.i = 0;
    renderQuestion();
    progress();
  });

  $('btnBack')?.addEventListener('click', () => {
    if (state.i === 0){ setScreen('start'); return; }
    state.i -= 1;
    renderQuestion();
  });

  $('btnNext')?.addEventListener('click', () => { goNext(); });

  $('btnDetailsBack')?.addEventListener('click', () => {
    setScreen('quiz');
    state.i = QUESTIONS.length - 1;
    renderQuestion();
  });

  ['fullName','email','phone','company2'].forEach(id => $(id)?.addEventListener('input', validateDetails));

  $('btnShowResult')?.addEventListener('click', () => {
    state.lead.fullName = (($('fullName')?.value) || '').trim();
    state.lead.email = (($('email')?.value) || '').trim();
    state.lead.phone = (($('phone')?.value) || '').trim();
    state.org.company = (($('company2')?.value) || '').trim();

    setScreen('result');
    renderResult();
  });

  $('btnSkipDetails')?.addEventListener('click', () => {
    state.lead = {fullName:'', email:'', phone:''};
    state.org.company = (($('company2')?.value) || '').trim();
    setScreen('result');
    renderResult();
  });

  $('btnRestart')?.addEventListener('click', () => {
    state.i = 0;
    state.answers = Array(QUESTIONS.length).fill(null);
    state.scores = {central:0, delegator:0, executor:0, visionary:0};
    state.firstHit = {central:null, delegator:null, executor:null, visionary:null};
    state.lead = {fullName:'', email:'', phone:''};
    state.org = {company:''};

    ['fullName','email','phone','company2'].forEach(id => { if ($(id)) $(id).value = ''; });

    progress();
    setScreen('start');
  });

  $('btnCopy')?.addEventListener('click', () => copyText(shareMessage()));

  $('btnCopyLink')?.addEventListener('click', () => {
    const link = (location && location.href) ? location.href : '';
    if (!link || link.startsWith('file:')){ showToast('×›×“×™ ×œ×”×¢×ª×™×§ ×§×™×©×•×¨ ×××™×ª×™ ×¦×¨×™×š ×œ××¨×— ××ª ×”×“×£.'); return; }
    copyText(link);
  });

  $('btnShareWa')?.addEventListener('click', () => {
    const txt = shareMessage();
    const url = 'https://wa.me/?text=' + encodeURIComponent(txt);
    window.open(url, '_blank', 'noopener');
  });

  // init
  try{ runSelfTests(); }catch(e){ console.error(e); }
  progress();
</script>
</body>
</html>
